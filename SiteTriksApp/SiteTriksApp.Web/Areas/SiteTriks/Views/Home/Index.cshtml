@inject SiteTriks.Configuration.LicenseManager LicenseManager

@model IEnumerable<SiteTriks.Models.DashboardConfiguration.DashboardConfigurationModel>

@{
    ViewBag.Title = "Dashboard";
}

<div class="fixed-top-2">
    @await Html.PartialAsync("SecondNavHeader")
</div>

<div class="dashboard-wrapper">
    <div class="row">
        @*<div class="side-navigation col-md-3 col-lg-2 col-sm-3 col-xs-3">
                @await Html.PartialAsync("SideNavigation")
            </div>*@
        <div class="dashboard-content">
            <div class="row" id="dashbpard-widgets">
                @foreach (var dashboardConfig in Model)
                {
                    bool flag = @dashboardConfig.DisplayName == "Google analytics";

                    <div class="dashboard-conten-column dashboard-widget @if (flag) { <text>google-analytics</text> }" data-type="@dashboardConfig.DisplayName">
                        @await Component.InvokeAsync(dashboardConfig.ClassName)
                    </div>
                }              
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script src="~/js/sitetriks/google-analytics-dashboard.js"></script>
    <script>
        $(document).ready(function () {
                (function (w, d, s, g, js, fs) {
                    g = w.gapi || (w.gapi = {}); g.analytics = { q: [], ready: function (f) { this.q.push(f); } };
                    js = d.createElement(s); fs = d.getElementsByTagName(s)[0];
                    js.src = 'https://apis.google.com/js/platform.js';
                    fs.parentNode.insertBefore(js, fs); js.onload = function () { g.load('analytics'); };
            }(window, document, 'script'));


            gapi.analytics.ready(function () {
                if ($('.google-analytics-widget').length != 0) {
                    googleAnalyticsWidgets.initGAOverview();
                }

                if ($('.google-analytics-countries').length != 0) {
                    googleAnalyticsWidgets.initGACountry();
                }

                if ($('.google-analytics-browsers').length != 0) {
                    googleAnalyticsWidgets.initGABrowsers();
                }

                if ($('.google-analytics-site-speed').length != 0) {
                    googleAnalyticsWidgets.initGASiteSpeed();
                }
            });

            
        });
    </script>
    <script>
        $(document).ready(function (ev) {
            $('#dashbpard-widgets').sortable({
                stop: function (event, ui) {
                    var sortedIDs = $('#dashbpard-widgets').sortable('toArray', { attribute: 'data-type' });

                    Loader.show('#fff');
                    Data.postJson({ url: '/sitetriks/dashboardconfiguration/save', data: { names: sortedIDs } }).then(function (res) {
                        Loader.hide();
                    }, Data.defaultError);
                }
            });

            let $container = $('.body-content');
            let dashboard = $container.find('.dashboard-wrapper');

            if (dashboard.length >= 1) {
                let $sideMenuButton = $('.open-side-nav.btn-side-nav img');
                $sideMenuButton.attr('src', '/images/show_white.svg')
            }
            else {
                $sideMenuButton.attr('src', '/images/show.svg')
            }
        });



                                //$('.side-nav-collapse').hide();
    </script>
}
